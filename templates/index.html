<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bootstrap Dashboard by Bootstrapious.com</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Google fonts - Roboto -->
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="css/style.default.css" id="theme-stylesheet">
    <!-- jQuery Circle-->
    <link rel="stylesheet" href="css/grasp_mobile_progress_circle-1.0.0.min.css">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/favicon.ico">
    <!-- Font Awesome CDN-->
    <!-- you can replace it by local Font Awesome-->
    <script src="https://use.fontawesome.com/99347ac47f.js"></script>
    <!-- Font Icons CSS-->
    <link rel="stylesheet" href="https://file.myfontastic.com/da58YPMQ7U5HY8Rb6UxkNf/icons.css">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
    
    <!-- For jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- For jRange http://nitinhayaran.github.io/jRange/demo/ -->
    <link rel="stylesheet" href="jquery.range.css">
    <script src="jquery.range.js"></script>

    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            height: 100%;
        }
        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>

</head>
<body>
<!-- Side Navbar -->
<nav class="side-navbar">
    <div class="side-navbar-wrapper">

        <div class="main-menu">
            <ul id="side-main-menu" class="side-menu list-unstyled">
                <li class="active">
                        <br>
                        <input type="text" name="firstname" id="thing">
                        <br>
                        <input type="button" value="Go" onclick="buttonPress()">
                </li>
                <li class="active">
                    <form>
                        <input type="hidden" class="slider-input" value="23" />
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="page home-page">
    <!-- navbar-->
    <header class="header">

    </header>

    <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
    <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
    <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
    <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
    <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
    <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
    <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->

    <!-- MAP Section-->
    <section class="dashboard-header">

        <style>
            /* Always set the map height explicitly to define the size of the div
             * element that contains the map. */
            #map {
                height: 950px;
            }
            /* Optional: Makes the sample page fill the window. */
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
        </style>

        <!-- http://jsfiddle.net/apxbmh2c/ -->

        <div id="map"></div>
        <script>

            // message is the var from Callum
            var map;
            var nameValue;
            var infowindow;
            var loc;
            var emotionArr;
            var emotion;
            var articleArr;
            var id;
            var icons;

            function mostEmo(){
                var maxScore = 0;
                for (i = 0; i < emotionArr.length; i++){
                    if (emotionArr[i].score > maxScore){
                        emotion = emotionArr[i];
                        maxScore = emotionArr[i].score;
                    }
                }
                id = emotion.tone_id;
            };

            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 3,
                    backgroundColor: '#000000',
                    center: new google.maps.LatLng(0, 0),
                    mapTypeId: 'roadmap',
                    streetViewControl: false
                });
                icons = {
                'anger': {
                    url: "http://www.emoji.co.uk/files/twitter-emojis/smileys-people-twitter/10492-winking-face.png", // url
                    scaledSize: new google.maps.Size(25, 25) // scaled size
                    //origin: new google.maps.Point(0,0), // origin
                    //anchor: new google.maps.Point(0, 0) // anchor
                },
                'disgust': {
                    url: "http://www.emoji.co.uk/files/twitter-emojis/smileys-people-twitter/10492-winking-face.png", // url
                    scaledSize: new google.maps.Size(25, 25) // scaled size
                    //origin: new google.maps.Point(0,0), // origin
                    //anchor: new google.maps.Point(0, 0) // anchor
                },
                'fear': {
                    url: "http://www.emoji.co.uk/files/twitter-emojis/smileys-people-twitter/10492-winking-face.png", // url
                    scaledSize: new google.maps.Size(25, 25) // scaled size
                    //origin: new google.maps.Point(0,0), // origin
                    //anchor: new google.maps.Point(0, 0) // anchor
                },
                'joy': {
                    url: "http://www.emoji.co.uk/files/twitter-emojis/smileys-people-twitter/10492-winking-face.png", // url
                    scaledSize: new google.maps.Size(25, 25) // scaled size
                    //origin: new google.maps.Point(0,0), // origin
                    //anchor: new google.maps.Point(0, 0) // anchor
                },
                'sadness': {
                    url: "http://www.emoji.co.uk/files/twitter-emojis/smileys-people-twitter/10492-winking-face.png", // url
                    scaledSize: new google.maps.Size(25, 25) // scaled size
                    //origin: new google.maps.Point(0,0), // origin
                    //anchor: new google.maps.Point(0, 0) // anchor
                }
            };
            };





            function buttonPress() {
                nameValue = document.getElementById("thing").value;
                document.getElementById("thing").value = "";
                var webSocket = new WebSocket("ws://moodymap.net/search");
                webSocket.onopen = function(event) {
                    webSocket.send(nameValue);
                };
                webSocket.onmessage = function(message) {
                    var data = JSON.parse(message.data);

                    loc = data.location;
                    loc = loc[0] + loc[1];
                    console.log(loc)
                    emotionArr = data.emotions;
                    articleArr = data.articles;

                    // Getting location
                    loc1 = loc.replace(/ /g,'+');
                    var s = "http://maps.google.com/maps/api/geocode/json?address=" + loc1;

                    console.log(s);

                    $.get(s, function( locData ) {
                        var latZ = locData.results[0].geometry.location.lat;
                        var lngZ = locData.results[0].geometry.location.lng;

                        console.log (latZ);
                        console.log (lngZ);

                        var links = '<div id="content">' + '<div id="siteNotice">' + '</div>' + '<h1 id="firstHeading" class="firstHeading">' + loc.toString() + '</h1>'; 

                        for (i = 0; i < articleArr.length; i++){
                            links += '<h3>' + '<a href=' + articleArr[i].link + '>' + articleArr[i].title + '</a></h3>'; 
                            // + '<img src="http://s3.favim.com/orig/40/bike-photography-place-places-pretty-Favim.com-335766.jpg" alt="description" width="200px">'  WE CAN ADD PHOTOS HERE
                        }

                        infowindow = new google.maps.InfoWindow();


                        function addMarker() {
                            mostEmo();
                            var marker = new google.maps.Marker({
                                position: {lat: latZ, lng: lngZ},
                                icon: icons[id],
                                map: map,

                            });
                            var content = links;
                            google.maps.event.addListener(marker, 'click', (function(marker, content, infowindow) {
                                return function(evt) {
                                    infowindow.setContent(content);
                                    infowindow.open(map, marker);
                                };
                            })(marker, content, infowindow));
                        }
                        addMarker();
                    });
                };
            }
            //google.maps.event.addDomListener(window, "load", initialize);


        </script>

        <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDrVXPuu6gxmw1s70jv1xD5MlgkR0Duj5k&callback=initMap">
        </script>

        <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
        <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
        <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
        <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
        <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
        <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->
        <!-- XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-->

    </section>
</div>
<!-- Javascript files-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="js/tether.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.cookie.js"> </script>
<script src="js/grasp_mobile_progress_circle-1.0.0.min.js"></script>
<script src="js/jquery.nicescroll.min.js"></script>
<script src="js/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<script src="js/charts-home.js"></script>
<script src="js/front.js"></script>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID.-->
<!---->
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-XXXXX-X');ga('send','pageview');
</script>
</body>
</html>
